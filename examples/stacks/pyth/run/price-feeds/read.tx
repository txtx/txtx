action "defaults" "stacks::set_default_network" {
    network_id = env.stacks_network_id
    stacks_api_url = env.stacks_api_url
}

wallet "alice" "stacks::connect" {
    expected_address = "SP19F0S4GN8CJQ4K9PKWRBVE00G2C86QTPTRXZ7GP"
}

input "price_id" {
    description = "Price ID to retrieve"
    value = "ec7a775f46379b5e943c3526b1c8d54cd49749176b0b98e02dde68d1bd335c17"
}

action "fetch_price" "std::send_http_request" {
    description = "Retrieve latest prices from Hermes Prices API"
    url = "${env.pyth_hermes_api_url}/api/latest_price_feeds?ids[]=${input.price_id}&binary=true"
}

output "value" {
    description = "Prices informations for ${input.price_id.value}"
    value = base64_decode(index(jq(action.fetch_price.response_body, ".[0].vaa"), 0))
}
